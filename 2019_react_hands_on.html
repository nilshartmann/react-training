<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>React Hands-on</title>

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"
    />
    <link rel="stylesheet" href="slides/styles.css" />
    <script src="slides/export.js"></script>
  </head>

  <body>
    <div class="reveal">
      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section data-state="title">
          <h3><span class="transparent-bg">EOS TechLab</span></h3>
          <h2 class="title" style="font-size:7rem">
            <b>Hands-on React</b>
          </h2>

          <h4>
            <span class="transparent-bg">
              <a href="http://nilshartmann.net" target="_blank">Nils Hartmann</a> |
              <a href="http://twitter.com/nilshartmann" target="_blank">@nilshartmann</a>
            </span>
          </h4>

          <p style="margin-top:4rem"></p>
          <div>
            <h3><span class="transparent-bg">Vorbereitung</span></h3>
            <p>
              <span class="transparent-bg"
                >git clone https://github.com/nilshartmann/react-training</span
              >
            </p>
            <p><span class="transparent-bg">cd blog-example/workspace</span></p>
            <p><span class="transparent-bg">npm install</span></p>
          </div>

          <p>
            <span class="transparent-bg">Slides: https://nils.buzz/techlab</span>
          </p>
          <p>
            <span class="transparent-bg">oder: react-training/2019_hands_on.html</span>
          </p>
        </section>
        <section>
          <h2>Nils Hartmann</h2>
          <p>
            <a href="https://nilshartmann.net" target="_blank">https://nilshartmann.net</a> /
            <a href="http://twitter.com/nilshartmann" target="_blank">@nilshartmann</a>
          </p>
          <p><em>Freiberuflicher Entwickler, Architekt, Trainer aus Hamburg </em></p>

          <div style="display:flex;justify-content:center">
            <div style="margin-right:15px">
              <p>Java</p>
              <p>JavaScript, TypeScript</p>
              <p>React</p>
              <p>Single-Page-Anwendungen</p>
              <p>GraphQL</p>
            </div>

            <div style="margin-left:15px">
              <a href="https://reactbuch.de"
                ><img
                  style="max-height:450px"
                  src="slides/images/react-buch-v2.png"
                /><br />https://reactbuch.de</a
              >
            </div>
          </div>
        </section>

        <section>
          <h2>Inhalt</h2>
          <div>
            <ul style="font-size: 85%">
              <li>
                <a href="#/example-app">Das Beispiel</a> <br />Die Beispiel-Anwendung, der
                -Workspace und m√∂gliche Erweiterungen
              </li>
              <li>
                <a href="#/reactgrundlagen">React Grundlagen</a>
                <br />Komponenten, JSX, State und Properties
              </li>
              <li>
                <a href="#/server">Arbeiten mit einem Server (REST)</a>
                <br />useEffect, fetch
              </li>
            </ul>
          </div>
        </section>

        <section id="example-app">
          <h1>Das Beispiel</h1>
          <h2>und der Beispiel-Workspace</h2>
        </section>

        <section>
          <h3>Beispiel-Anwendung</h3>
          <a target="_blank" href="blog-example/beispiele/02_blog-app/build/index.html">
            <img src="blog-example/blog-example.png" style="height:650px" />
          </a>

          <p>cd blog-example/beispiele/02_blog-app && npm start</p>
        </section>

        <section>
          <h3>Der Beispiel-Workspace</h3>
          <p>Im Verzeichnis <b>code/blog-example/workspace</b> ist schon alles vorbereitet</p>
          <p>
            Du kannst dort mit <b>npm install</b> und <b>npm start</b> die (leere) Anwendung starten
          </p>
          <p>
            In der Datei App.js kannst Du deine Anwendung implementieren <br />Dazu bitte in
            index.js die App-Komponente importieren (siehe Kommentare dort)
          </p>
          <p>
            Wenn Du √Ñnderungen machst, wird die Anwendung automatisch gebaut und im Browser
            aktualisiert
          </p>
        </section>
        <section>
          <h3>M√∂gliche Features #1</h3>

          <p>Du kannst im Team eine App ganz nach deinen W√ºnschen bauen üòä</p>
          <p>Zur Inspiration hier einige Ideen:</p>
          <ul>
            <li>Schritt 1: Ein Formular zur Eingabe eines neuen Blog-Posts</li>
            <li>
              Schritt 2: Neu eingegebene Blog-Posts werden in einer Liste unterhalb des Formulars
              angezeigt <br />Architekur-Idee: Eigene Komponente f√ºr ein einzelnes Blog-Post, das
              Formular sowie eine zentrale App-Komponente die die Liste der Posts verwaltet
            </li>
            <li>
              Schritt 3: Speichern der Blog-Posts auf dem Server
            </li>
          </ul>
        </section>

        <section>
          <h3>M√∂gliche Features #2</h3>
          <ul>
            <li>Validierung der Eingaben im Formular (keine Leer-Eingaben etc)</li>
            <li>Das Formular kann ein- und ausgeblendet werden</li>
            <li>Formular zur Eingabe des Blog-Posts auf einer einzelnen Seite</li>
            <li>
              Darstellung eines einzelnen Posts auf einer eigenen Seite (Trennung in √úbersichtsliste
              und Detail-Ansicht)
            </li>
          </ul>
        </section>

        <section data-state="js-exkurs">
          <h2>React Devtools</h2>
          <em>React Developer Tools f√ºr Chrome und Firefox</em>
          <p>Untersuchen der React Anwendung zur Laufzeit</p>

          <ul>
            <li>
              <a
                href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=en"
                target="_blank"
                >Chrome</a
              >
            </li>
            <li>
              <a
                href="https://addons.mozilla.org/en-US/firefox/addon/react-devtools/"
                target="_blank"
                >Firefox</a
              >
            </li>
          </ul>

          <p><img src="slides/images/screenshot-react-dev-tools.png" /></p>
        </section>

        <!-- <section>
          <h2>√úbung 1: React Hello-World</h2>
          <h3>
            <em>Mach dich mit den Werkzeugen vertraut und schreib deine erste React-Komponente</em>
          </h3>
        </section>
        <section>
          <h3>Das Beispiel-Projekt</h3>
          <p>Workspace</p>
          <ul class="x-list">
            <li style="margin-bottom:40px">
              <code>2019_react_wdc_hh.html</code> Slides im Root-Verzeichnis
            </li>
            <li style="margin-bottom:40px">
              <code>code/<b>workspace</b></code
              >: Verzeichnis f√ºr Eure √úbungen<br />üëâ&nbsp;Empfehlung: dieses Verzeichnis in VS
              Code/IDE √∂ffnen
            </li>
            <li>
              <code>code/<b>material</b></code
              >: Code als Ausgangspunkt f√ºr √úbungen
            </li>
            <li>
              <code>code/<b>schritte</b></code
              >: Fertige St√§nde nach den einzelnen Teilen
            </li>
          </ul>
        </section> -->
        <section class="todo">
          <h2>Der Workspace</h2>
        </section>
        <section>
          <h3>Tool-Chain starten (falls noch nicht gemacht)</h3>

          <ol style="font-size: 85%">
            <li>
              <code>cd code/blog-example/workspace</code>
            </li>

            <li>
              <code>npm start</code>
            </li>

            <li>
              √ñffne <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> im
              Browser
            </li>

            <li>Wenn auf der Seite 'Hello, World' steht, ist alles gut</li>
          </ol>

          <img src="slides/images/screenshot-npm-start-cra.png" />
        </section>

        <section id="reactgrundlagen">
          <h1>React Grundlagen</h1>
        </section>

        <section>
          <h2>React Dokumentation</h2>
          <p>
            <a href="https://reactjs.org/docs/hello-world.html">
              https://reactjs.org/docs/hello-world.html
            </a>
          </p>
        </section>
        <section>
          <h3>Eine erste Komponente: Hello, World!</h3>
          <ul>
            <li>Beispiel Schritt-f√ºr-Schritt (<code>blog-example/workspace</code>)</li>
          </ul>
        </section>

        <section id="interaktiv-hellomessage">
          <h3>Hello World React</h3>
          <code>HelloWorld.js</code>
          <pre><code data-trim contenteditable>
  import React from "react";
  
  export default function HelloWorld(props) {
    const [greeting, setGreeting] = React.useState(props.initialGreeting || "");
  
    return (
      &lt;div>
      &lt;input onChange={event => setGreeting(event.target.value)} value={greeting} />
  
      &lt;p>{greeting}, World&lt;/p>
      &lt;button onClick={() => setGreeting("")}>Clear&lt;/button>
      &lt;/div>
    );
  }
            </code></pre>
        </section>

        <section>
          <h3>Aufruf</h3>
          <div class="fragment">
            <p>
              <code>index.html</code>
            </p>
            <pre><code data-trim contenteditable>
  &lt;html>
    &lt;-- ... -->
    &lt;body>
      <div id="root"></div>
    &lt;/body>
  &lt;/html>
  </code></pre>
          </div>
          <div class="fragment">
            <p>
              <code>index.js</code>
            </p>
            <pre><code data-trim contenteditable class="javascript">
  import React from 'react';
  import ReactDOM from 'react-dom';
  
  import HelloWorld from './HelloWorld';
  
  ReactDOM.render(&lt;HelloWorld initialGreeting="Hello"/>, 
    document.getElementById('root')
  );
  </code></pre>
          </div>
        </section>
        <section>
          <h3>React: JSX</h3>
          <ul>
            <li style="font-size: 80%" class="fragment">
              Wird wie HTML hingeschrieben, inkl Attribute:
              <pre><code class="xml" contenteditable data-trim>
&lt;div>&lt;input type="text"/>&lt;/div>
                    </code></pre>
            </li>
            <li style="font-size: 80%" class="fragment">
              Achtung! <code>class</code>-Attribut hei√üt <code>className</code>:
              <pre><code class="xml" contenteditable data-trim>
                        &lt;h1 className="title">...&lt;/h1>
                    </code></pre>
            </li>
            <li style="font-size: 80%" class="fragment">
              Attribute, die keine Strings sind, m√ºssen in {} eingeschlossen werden:
              <pre><code class="xml" contenteditable data-trim>
&lt;Counter label="Count" count={7} showValues={true} />
                    </code></pre>
            </li>
            <li style="font-size: 80%" class="fragment">
              Kann pures JavaScript enthalten, eingeschlossen in {}:
              <pre><code class="xml" contenteditable data-trim>
const title = 'Hello, World';
&lt;h1>{title.toUpperCase()}&lt;/h1>
                    </code></pre>
            </li>

            <li style="font-size: 80%" class="fragment">
              CSS-Eigenschaften werden als Objekt √ºbergeben in Camel-Case-Notation:
              <pre><code class="xml" contenteditable data-trim>
const styles = { marginLeft: '10px', border: '1px solid red' };
&lt;h1 style={styles}>...&lt;/h1>
                    </code></pre>
            </li>
          </ul>
        </section>
        <section>
          <h3>React: JSX #2</h3>
          <ul>
            <li style="font-size: 80%" class="fragment">
              Fragmente (rendern selber kein Element in den DOM, nur ihre Kind-Elemente):
              <pre><code class="xml" contenteditable data-trim>
function Choice() { 
  return &lt;&gt;
    &lt;li>Yes&lt;/li> 
    &lt;li>No&lt;/li>
  &lt;/>              
}  
                    </code></pre>
            </li>
            <li style="font-size: 80%" class="fragment">
              null, false oder boolean, um nichts zu rendern:
              <pre><code class="xml" contenteditable data-trim>
function ErrorMessage(props) {
  if (!props.msg) {
    return null; // oder false oder true
  }

  return <h1>Fehler: {props.msg}</h1>;
}              
                    </code></pre>
            </li>

            <li style="font-size: 80%" class="fragment">
              Kommentare
              <pre><code class="xml" contenteditable data-trim>
  function MyComponent() {
    return <div>
      { /* hier ist javascript, deswegen block-kommentare erlaubt */ }
    </div>;
  }              
                      </code></pre>
            </li>
          </ul>
        </section>

        <section>
          <h3>React: Properties und Zustand</h3>
          <ul class="fragment">
            <li>
              <b>Properties</b> werden der Komponente von <b>au√üen</b> √ºbergeben (und nicht
              ver√§ndert)
            </li>
            <li class="fragment">
              <b>Zustand (State)</b> ist eine <b>innere</b> Eigenschaft der Komponente (die
              ver√§ndert werden kann)
            </li>
          </ul>
        </section>

        <section>
          <h3>Properties ("Props") einer Komponente</h3>

          <ul>
            <li class="fragment">
              sind Objekte mit Key-Value-Paaren
            </li>
            <li class="fragment">
              werden als 1. Methoden-Parameter an Komponente √ºbergeben
            </li>
            <li class="fragment">d√ºrfen nicht ver√§ndert werden</li>
          </ul>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
            function Header(props) {
                return (
                  &lt;h1 style={{color: props.titleColor}}>{props.title}&lt;/h1>
                );
              }
            }
            </code></pre>

          <pre class="fragment"><code class="javascript" contenteditable data-trim>
// Mit Destructuring
function Header({titleColor, title}) {
    return (
      &lt;h1 style={{color: titleColor}}>{title}&lt;/h1>
    );
  }
}
                </code></pre>
        </section>

        <section>
          <h3>Zustand einer Komponente: useState-Hook</h3>
          <ul>
            <li>Beispiel: Inhalt eines Eingabefelds, Daten vom Server, Menu offen oder zu</li>
            <li class="fragment"><b>Werte</b> √ºblicherweise immutable</li>
            <li class="fragment">Arbeiten mit Zustand √ºber <b>useState</b>-Hook</li>
            <li class="fragment">
              useState liefert Array mit zwei Werten zur√ºck: aktuellen Zustand, und setter-Funktion
              um Zustand zu ver√§ndern
            </li>
          </ul>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
function HelloWorld(props) {
  const [greeting, setGreeting] = React.useState(props.initialGreeting);

  return &lt;input onChange={e => setGreeting(e.target.value) value={greeting} />;
}
                  </code></pre>
          <ul>
            <li class="fragment">
              Aufruf des Setters <b>l√∂st erneutes rendern der <i>gesamten</i> Komponente aus</b>
            </li>
            <li class="fragment">
              Es k√∂nnen mehrere States erzeugt werden, durch Verwendung mehrerer useState-Aufrufe
            </li>
            <li class="fragment">
              <b>Zustand</b> ist eines der <b>zentralen</b> Konzepte von React
            </li>
          </ul>
        </section>
        <section>
          <h3>React Hooks</h3>
          <em>Mit React Hooks kann sich eine Komponente in Zustand und Lebenszyklus "einhaken"</em>
          <ul>
            <li class="fragment">
              Hooks sind "normale" Funktionen, m√ºssen aber mit <code>use</code> beginnen (useState,
              useEffect, ...)
            </li>
            <li class="fragment">
              Beispiel: Importieren und verwenden von Hooks

              <pre><code class="javascript" contenteditable data-trim>
                import React from "react";

                function HelloWorld(props) {
                  const [greeting, setGreeting] = React.useState(props.initialGreeting);
                  // ...
                }
                                  </code></pre>
              <pre class="fragment"><code class="javascript" contenteditable data-trim>
                                      import React, { useState } from "react";
                      
                                      function HelloWorld(props) {
                                        const [greeting, setGreeting] = useState(props.initialGreeting);
                                        // ...
                                      }
                                                        </code></pre>

              <ul>
                <li class="fragment">
                  (<code>React</code> muss immer <b>importiert</b> werden, wenn JSX verwendet wird!)
                </li>
              </ul>
            </li>
          </ul>
        </section>
        <section>
          <h3>React Hooks</h3>
          <em>Es gibt einige Regeln zu beachten, bei der Verwendung von Hooks üëÜ</em>
          <p style="font-size:75%;margin-top:0">
            <a href="https://reactjs.org/docs/hooks-rules.html"
              >(https://reactjs.org/docs/hooks-rules.html)</a
            >
          </p>
          <div class="fragment">
            <p>Einschr√§nkungen:</p>
            <ul>
              <li class="fragment">
                Hooks k√∂nnen nur in Funktionskomponenten (und anderen Hooks) aufgerufen werden
              </li>
              <li class="fragment">
                Hooks m√ºssen immer in derselben Reihenfolge und auf Top-Level-Ebene verwendet werden
                <ul>
                  <li>Verboten z.B. in Schleifen, if-Abfragen oder in anderen Funktionen</li>
                </ul>
              </li>
              <li class="fragment">
                Es gibt ein
                <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">ESLint Plug-in</a>
                zur korrekten Verwendung der Hooks
              </li>
            </ul>
          </div>
          <p class="fragment">
            <em
              >Der Hooks-Mechanismus basiert intern darauf, dass React sich die Reihenfolge der
              <code>useXyz</code>-Aufrufe merkt!</em
            >
          </p>
        </section>
        <section>
          <h3>React Hooks</h3>

          <em>Beispiele f√ºr korrekte und unerlaubte Verwendung</em>

          <pre class="fragment"><code class="javascript" contenteditable data-trim>
              // ERLAUBT:
              function HelloWorld(props) {
                const [greeting, setGreeting] = React.useState(props.initialGreeting);
                const [name, setName] = React.useState(props.initialName);
                // ...
              }
                                </code></pre>

          <pre class="fragment"><code class="javascript" contenteditable data-trim>
                                    // ERLAUBT:
                                    function HelloWorld(props) {
                                      const [greeting, setGreeting] = React.useState(props.initialGreeting);
                                      const uppercaseGreeting = greeting.toUpperCase(); 
                                      const [name, setName] = React.useState(props.initialName);
                                      // ...
                                    }
                                                      </code></pre>

          <pre class="fragment"><code class="javascript" contenteditable data-trim>
                                    // VERBOTEN:
                                    function HelloWorld(props) {
                                      const [greeting, setGreeting] = React.useState(props.initialGreeting);
                                      if (greeting !== null) {
                                        const [name, setName] = React.useState(props.initialName);
                                      }
                                      // ...
                                    }
                                                      </code></pre>

          <pre class="fragment"><code class="javascript" contenteditable data-trim>
                          // VERBOTEN:
                          function HelloWorld(props) {
                            const [greeting, setGreeting] = React.useState(props.initialGreeting);
                            if (greeting === null) {
                              return <h1>Please enter greeting first</h1>;
                            }
                            // ...
                          }
                                            </code></pre>
        </section>
        <section>
          <h3>React Hooks</h3>
          <em>Beispiele f√ºr korrekte und unerlaubte Verwendung #2</em>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
              // VERBOTEN 
              function HelloWorld(props) {
                function initState() {
                  return React.useState(props.initialGreeting);
                }
                const [greeting, setGreeting] = initState();
              }
            </code></pre>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
                // VERBOTEN (initState ist 'normale' Funktion)
                function initState() {
                  return React.useState(props.initialGreeting);
                }

                function HelloWorld(props) {
                  // w√§re erlaubt, wenn initState 'useInitState' hie√üe
                  const [greeting, setGreeting] = initState();
                }
              </code></pre>
        </section>

        <section>
          <h3>Render Zyklus</h3>
          <img src="slides/images/render-cycle.png" height="550px" />
        </section>

        <section>
          <h3>Virtual DOM</h3>
          <p>"Rendern" hat leider doppelte Bedeutung!</p>
          <img src="slides/images/vdom.png" style="height:650px" />
        </section>

        <section>
          <h3>Listen</h3>
          <p>JSX bietet nichts f√ºr Listen</p>
          <p>
            Ausgabe typischerweise √ºber
            <code>Array.map()</code>
          </p>
          <p>Elemente einer Liste brauchen einen eindeutigen Key</p>

          <pre class="fragment"><code class="javascript" contenteditable data-trim>
const posts = [
  { id: 0, title: 'Hello World', body: 'Lorem ipsum' },
  { id: 1, title: 'React in a Nutshell', body: 'Lets get started with React' }
];

function PostList(props) {
  return {props.posts.map(post => (
    &lt;div key={post.id}>
        &lt;h1>{post.title}&lt;/h1>
        &lt;p>{post.body}&lt;/p>
    &lt;/div>
  )}
}
</code></pre>
        </section>

        <section class="todo">
          <h3>Teil III (b)</h3>
          <h2>Anwendungen und Komponentenhierarchien</h2>
        </section>
        <section>
          <h3>Problem: Kommunikation zwischen Komponenten</h3>
          <p>#1: Welche Komponente soll angezeigt werden (Master oder Detail?)</p>
          <img src="slides/images/component-hierarchy-problems-01-views.png" style="height:550px" />
        </section>
        <section>
          <h3>Problem: Kommunikation zwischen Komponenten</h3>
          <p>#2: Wo wird der State (Greetings) verwaltet?</p>
          <img
            src="slides/images/component-hierarchy-problems-02-greeting.png"
            style="height:550px"
          />
        </section>
        <section>
          <h3>Problem #1</h3>
          <h2>Welche Komponente soll angezeigt werden?</h2>
          <p>Master oder Detail?</p>
          <p>Schritt-f√ºr-Schritt in <code>code/workspace-live-coding</code></p>
        </section>
        <section>
          <h3>Controller Komponente #1</h3>
          <p>Verwaltet den Zustand (u.a. welche Komponente sichtbar ist)</p>
          <img src="slides/images/greeting-hierarchy-mode.png" style="height:550px" />
        </section>
        <section>
          <h3>Controller Komponente #2</h3>
          <p>Rendering der Children</p>
          <pre><code class="javascript" contenteditable data-trim>
function GreetingController(props) {
  const [mode, setMode] = React.useState(MODE_MASTER);

  if (mode === 'MASTER') {
    return &lt;GreetingMaster />;
  } 

  return &lt;GreetingDetail />;
}            
            </code></pre>
        </section>

        <section>
          <h3>Controller Komponente</h3>
          <p class="fragment">Wie wird zwischen den Komponenten kommuniziert?</p>
          <p class="fragment">Beispiel: Child-Komponente will Parent Informationen √ºbermitteln</p>
          <p class="fragment">Callback-Funktionen als Properties #1</p>
          <img
            class="fragment"
            src="slides/images/greeting-hierarchy-mode-callback.png"
            style="height:550px"
          />
        </section>

        <section>
          <h3>Controller Komponente</h3>
          <p>Kommunikation mit Children: Callback-Funktionen als Properties #2</p>
          <pre><code class="javascript" contenteditable data-trim>
function GreetingController(props) {
  const [mode, setMode] = React.useState('MASTER');

  if (mode === 'MASTER') {
    return &lt;GreetingMaster onAdd={() => setMode('DETAIL')} />;
  } 

  return &lt;GreetingDetail onSave={() => setMode('MASTER')} />;
}      

  
</code></pre>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
  function GreetingMaster(props) {
      return (
        // Tabelle mit Greetings ...
        &lt;button onClick={props.onAdd}>Add&lt;/button>
      )
  }            
              </code></pre>
        </section>

        <section>
          <h3>Problem #2</h3>
          <h2>Wo wird der State (Greetings) verwaltet?</h2>
          <p>Wie kommen neue Greetings (GreetingDetail) in die Liste (GreetingMaster)?</p>
        </section>
        <section>
          <h3>Controller Komponente</h3>
          <p class="fragment">Verwaltet den "globalen" State</p>
          <p class="fragment">State wird als Property an Children √ºbergeben</p>
          <img
            class="fragment"
            src="slides/images/greeting-hierarchy-greetings.png"
            style="height:550px"
          />
        </section>
        <section>
          <h3>Controller Komponente</h3>
          <p>State wird als Property an Children √ºbergeben #2</p>
          <pre><code class="javascript" contenteditable data-trim>
function GreetingController(props) {
  const [mode, setMode] = React.useState('MASTER');
  const [greetings, setGreetings] = React.useState(props.initialGreetings);

  if (mode === 'MASTER') {
        return &lt;GreetingMaster
          greetings={greetings}
          onAdd={() => setMode('DETAIL')}
        />
  }
  // ...
}
  </code></pre>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
function GreetingMaster(props) {
    return (
      &lt;table>
        { props.greetings.map(g => &lt;tr>...&lt;/tr>) }
      &lt;/table>
      &lt;button onClick={props.onAdd}>Add&lt;/button>
    )
}            
                </code></pre>
        </section>
        <section>
          <h3>Controller Komponente</h3>
          <p class="fragment">Verwaltet den "globalen" State</p>
          <div class="fragment">
            <img src="slides/images/greeting-hierarchy-onsave.png" style="height:550px" />
            <p>
              <span style="color: #9D4493">Neues Greeting</span> wird per Callback-Funktion zur√ºck
              gegeben
            </p>
          </div>
        </section>
        <section>
          <h3>Controller Komponente</h3>
          <p>Neues Greeting wird per Callback-Funktion √ºbergeben #2</p>
          <pre><code class="javascript" contenteditable data-trim>
  function GreetingController(props) {
    const [mode, setMode] = React.useState('MASTER');
    const [greetings, setGreetings] = React.useState(props.initialGreetings);

    if (mode === 'MASTER') {
      // ...
    }

    return &lt;GreetingDetail 
      onSave={newGreeting => {
        setGreetings: [...greetings, newGreeting];
        setMode('MASTER');
      }} 
    />;
  }      
    </code></pre>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
  function GreetingDetail(props) {
    const [name, setName] = React.useState();
    const [greeting, setGreeting] = React.useState();
      return (
        &lt;input name="name" . . . />
        &lt;input name="greeting" . . . />
        &lt;button onClick={() => props.onSave({name: name, greeting: greeting})}>
          Add
        &lt;/button>
      )
  }            
                  </code></pre>
        </section>

        <section>
          <h3>Komponenten in Hierarchien</h3>
          <p>Beispiel: Unsere Anwendung (Zusammenfassung)</p>
          <img src="slides/images/greeting-hierarchy.png" style="height:550px" />
        </section>

        <section>
          <h3>Smart und Dumb Components</h3>
          <p style="font-size: smaller;margin-bottom:0">
            (Alternativ: Container und Presentation Components)
          </p>
          <img
            style="margin-top:0;max-height:600px"
            src="slides/images/component-communication.png"
          />
        </section>

        <section id="server">
          <h1>Daten lesen und schreiben vom Server</h1>
        </section>

        <section>
          <h3>Der Blog-Server</h3>
          <p>
            Der Server ist bereits fertig. Zum Starten:
          </p>
          <pre><code>
                  cd react-training/blog-example/backend
                  npm start
                </code></pre>
          <p>Der Server ist √ºber Port 7000 erreichbar</p>
          <p>
            Zum Testen:
            <a href="http://localhost:7000/posts">http://localhost:7000/posts</a>
          </p>
        </section>

        <section>
          <h3>Der Blog-Server</h3>
          <p>
            Die Endpunkte:
          </p>
          <p><b>GET /posts</b> Alle Blog Posts abfragen</p>
          <p><b>GET /posts?short</b>: Alle Blog Post IDs und deren Titel</p>
          <p><b>GET /posts/:id</b> Einen einzelnen Blog Post lesen</p>
          <p>
            <b>POST /posts</b> Einen neuen Blog Post anlegen. Als Payload/Body muss ein Objekt mit
            <code>title</code> und <code>string</code> √ºbertragen werden. Als Ergebnis wird der
            komplette, neue Blog Post (inklusive ID) zur√ºck gegeben
          </p>
          <p><b>DELETE /posts/:id</b> Einen Blog-Post l√∂schen</p>
          <p>
            Au√üerdem kann allen Requests der URL Parameter<b>?slow</b> √ºbergeben werden, um die
            Antwort k√ºnstlich zu verlangsamen (wenn ihr z.B. mit Wartezust√§nden arbeiten wollt)
          </p>
        </section>

        <section>
          <h3>Server-Calls</h3>
          <p>React macht keine Angabe, wie Server-Calls (technisch) gemacht werden</p>
          <p>
            H√§ufig in React verwendet:
            <a href="https://developer.mozilla.org/de/docs/Web/API/Fetch_API">fetch</a> API
          </p>
        </section>

        <section>
          <h3>Beispiel: fetch</h3>
          <p>Daten lesen per GET</p>
          <pre><code class="javascript" contenteditable data-trim>
          // F√ºr GET Zugriff reicht es, die URL anzugeben:
          try {
            const response = await fetch('http://localhost:7000/api/greetings')
            const json = await response.json();
            // ...
          } (catch ex) {
            console.error('request failed', ex)
          }
          </code></pre>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
// Alternative mit Promise:

fetch('http://localhost:7000/posts')
  .then(response => response.json())
  .then(json => /* ... */)
  .catch(ex => console.error('request failed', ex));
</code></pre>
        </section>
        <section>
          <h3>Beispiel #2: fetch</h3>
          <p>Daten lesen per POST</p>
          <div class="fragment">
            <p>
              <code>fetch</code> erwartet als zweiten Parameter ein Objekt mit
              Konfigurationsparametern, u.a:
            </p>

            <ul>
              <li>
                <code>method</code>: gibt die HTTP Methode an ( <code>PUT</code>, <code>POST</code>,
                <code>DELETE</code>, ...)
              </li>
              <li><code>headers</code>: Objekt mit HTTP Headern f√ºr den Request</li>
              <li><code>body</code>: Der Request-Payload (als String)</li>
            </ul>
          </div>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
const response = await fetch(url, {
  method: 'POST',
  headers: {
    'Accept': 'application/json',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(payload)
})
// ... 
    </code></pre>
        </section>

        <section>
          <h3>fetch im Detail</h3>

          <pre><code class="javascript" contenteditable data-trim>
  try {
    // 1. fetch gibt ein Promise zur√ºck, dass mit dem
    // Response-Objekt aufgel√∂st wird, wenn die Antwort vom Server
    // kommt
    const response = await fetch('http://localhost:7000/posts');
  
    // 2. das Response Objekt enth√§lt eine json() Funktion,
    // die das geparse JSON aus der Antwort zur√ºckliefert
    const posts = await response.json();
  
    // WAS MACHEN WIR MIT DER ANTWORT?
    // ???
  } catch (err) {
    // 4. Falls etwas schief geht, Fehler loggen
    console.error('request failed', err);
  }
  
  </code></pre>
          <p>
            <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch API Doku</a>
          </p>
        </section>

        <section>
          <h3>useEffect-Hook</h3>
          <em
            >In der Render-Phase einer Komponente (das ist die Ausf√ºhrung der Komponenten-Funktion)
            darfst Du keine Seiteneffekte (z.B. Server-Zugriffe) machen.</em
          >
          <p>
            Der useEffekt-Hook erlaubt es dir aber, Seiteneffekte zu definierten (sp√§teren)
            Zeitpunkten auszuf√ºhren
          </p>
        </section>
        <section>
          <h3>useEffect-Hook</h3>

          <div class="fragment">
            <p>
              Als 1. Parameter √ºbergibst Du eine Callback-Funktion, die deinen Code enth√§lt. Dieser
              darf Seiteneffekte enthalten, z.B. einen fetch-Aufruf
            </p>

            <pre class="fragment"><code class="javascript" contenteditable data-trim>
                function App(props) {
                  React.useEffect( 
                    () => console.log("Ich werde nach JEDEM Rendern ausgef√ºhrt")
                  );
                }
              </code></pre>
          </div>

          <div class="fragment">
            2. Parameter (Array) gibt an, wann der Effekt ausgef√ºhrt werden soll:

            <pre class="fragment"><code class="javascript" contenteditable data-trim>
                function App(props) {
                  React.useEffect( 
                    () => console.log("Ich werde nur nach 1. Rendern ausgef√ºhrt"),
                    []
                  );
                }
              </code></pre>
          </div>

          <div class="fragment">
            Nach 1. Rendern ausf√ºhren und wenn sich das postId-Property √§ndert:

            <pre class="fragment"><code class="javascript" contenteditable data-trim>
                  function BlogPost(props) {
                    React.useEffect(
                      () => console.log("..."), 
                      [props.postId]
                    );
                  }
                </code></pre>
          </div>
        </section>

        <section>
          <h3>useEffect Hook</h3>

          <p>Zwei Parameter:</p>
          <ol>
            <li class="fragment">
              Callback-Funktion, die aufgerufen wenn entsprechendes Ereignis eintritt (z.B.
              initiales Rendern abgeschlossen)
            </li>
            <li class="fragment">
              Ein Array mit Abh√§ngigkeiten:
              <ul>
                <li class="fragment">
                  Wenn kein Array angegeben wird, wird der Effekt nach jedem Rendern ausgef√ºhrt
                  (Achtung! Endlosschleife m√∂glich)
                </li>
                <li class="fragment">
                  Wenn ein leeres Array angegeben wird, wird der Effekt nur nach dem 1. Rendern
                  ausgef√ºhrt
                </li>
                <li class="fragment">
                  Wenn Werte angegeben werden, wird der Effekt ausgef√ºhrt, wenn sich mind. 1 Wert
                  zwischen zwei Render-Zyklen ver√§ndert hat
                </li>
              </ul>
            </li>
          </ol>
        </section>

        <section>
          <h3>Initiales Laden von Daten</h3>

          <div>
            <p>
              <code>useEffect</code> und (<code>useState</code>) werden verwendet um Daten nach dem
              1. Rendern zu laden:
            </p>
            <pre><code class="javascript" contenteditable data-trim>
                function App() {
                  const [posts, setPosts] = React.useState([]);
                
                  React.useEffect(() => {
                    fetch("http://localhost:7000/posts")
                      .then(response => response.json())
                      .then(json => setPosts(json));
                  }, []);

                  return {posts.map(p => (
                    &lt;Post key={p.id} post={p} />
                  ))}
                }
                
                </code></pre>
          </div>
        </section>

        <section>
            <h3>Initiales Laden von Daten</h3>

            <p>Lifecycle des gezeigten Beispiels:</p>
            <ol>
              <li>Komponenten-Funktion wird ausgef√ºhrt (Komponente wird "gerendert")</li>
              <li>State mit leerem Array initialisiert</li>
              <li>Effekt zum Laden der Daten wird registriert</li>
              <li>UI-Code wird zur√ºckgegeben (leere Liste mit Posts, da noch keine Daten geladen sind)</li>
              <li>React erzeugt den nativen DOM f√ºr die UI</li>
              <li>Der registrierte Effekt wird ausgef√ºhrt, der Server-Call gestartet</li>
              <li>Der Server-Call kommt zur√ºck, die Daten werden in den State gesetzt</li>
              <li>Durch das Setzen des States, wird die Komponente erneut gerendert, also wird die Komponenten-Funktion neu aufgerufen</li>
              <li>Der State ist nun das Array mit den geladenen Daten</li>
              <li>Der Effekt wird nicht erneut registriert (leeres Array als 2. Parameter)</li>
              <li>Die Komponente liefert nun die UI f√ºr die geladene Liste zur√ºck</li>
            </ol>
            


          </section>

        <section>
          <h3>Speichern von Daten</h3>
          <p>Zum Beispiel als Folge einer Benutzerinteraktion:</p>
          <p class="fragment">Im Event-Handler d√ºrfen wir direkt Seiteneffekte nutzen</p>
          <pre class="fragment"><code class="javascript" contenteditable data-trim>
function App(props) {
  // laden, wie gesehen
  React.useEffect( ... );

  function addPost(post) {
    fetch("http://localhost:7000/posts", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(post)
    })
      .then(response => response.json())
      .then(newPost => setPosts([newPost, ...posts]));
  }


  return
    ...
      &lt;CreatePostForm onAdd={newPost => addPost(newPost)} />
    ...
}
                </code></pre>
        </section>

        <section>
          <h2>Geschafft üòä</h2>
          <h3>Vielen Dank f√ºr Eure Teilnahme!</h3>
          <p>
            Kontakt:
          </p>
          <p>Mail: <a href="mailto:nils@nilshartmann.net">nils@nilshartmann.net</a></p>
          <p>
            Web: <a href="https://nilshartmann.net" target="_blank">https://nilshartmann.net</a>
          </p>
          <p>
            Twitter: <a href="https://twitter.com/nilshartmann" target="_blank">@nilshartmann</a>
          </p>
        </section>
      </div>
    </div>

    <script src="slides/reveal.js/lib/js/head.min.js"></script>
    <script src="slides/reveal.js/js/reveal.js"></script>
    <script src="slides/reveal.js/lib/jquery-2.2.4.js"></script>
    <script src="slides/reveal-config.js"></script>
  </body>
</html>
